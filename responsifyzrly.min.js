/**
 * Responsifyzrly 
 * A library for generating appropriate images for use in responsive designs
 * This script sets the necessary cookie for server-side processing
 *
 * @version     0.1.0
 * @copyright   2012 Unit Interactive, LLC - UnitInteractive.com
 * @author      R.A. Ray - RobertAdamRay.com
 * @link        https://github.com/unitinteractive/responsifyzrly
 * @license     
 *
 * Dual licensed under the MIT license and GPL license:
 * http://opensource.org/licenses/MIT
 * http://www.gnu.org/licenses/gpl.html
 */

var pixelRatio = window.devicePixelRatio;
var rspvly = {options : {}};

(function(f,g){var h=f.options||{};h.speedTestUri=h.speedTestUri||'images/50K.jpg';h.speedTestKB=h.speedTestKB||50;h.speedTestTimeout=h.speedTestTimeout||300;speedTestForceBandwidth=h.speedTestForceBandwidth||false;h.cookieExpire=h.cookieExpire||30;h.forceRefresh=h.forceRefresh||true;var j={'resolution':Math.max(screen.width,screen.height),'pixel_ratio':pixelRatio?pixelRatio:'1'};if(h.forceResolution){j.resolution=h.forceResolution}if(h.forcePixelRatio){j.pixel_ratio=h.forcePixelRatio}var k=function(a){j.bandwidth=a;clearTimeout(r);l()};var l=function(){var a='rspvly=';for(var b in j){a+=b+'='+j[b]+'&'}a+='; path=/;';var c=new Date();c.setTime(c.getTime());var d=h.cookieExpire*60*1000;d=new Date(c.getTime()+d);a+='expires='+d.toUTCString();g.cookie=a;if(h.forceRefresh){g.location.reload(true)}};var m=function(){var a=g.cookie.split(';');var b='';var c='';var d='';var e=false;for(i=0;i<a.length;i++){b=a[i].split('=');c=b[0].replace(/^\s+|\s+$/g,'');if(c=='rspvly'){e=true;if(b.length>1){d=unescape(b[1].replace(/^\s+|\s+$/g,''))}return d;break}b=null;c=''}if(!e){return false}};if(!m()){if(h.speedTestForceBandwidth){k(h.speedTestForceBandwidth);return}var n=g.createElement('img');var o;var p;var q;n.onload=function(){o=(new Date()).getTime();var a=(o-p)/1000;a=(a>0?a:1);var b=((h.speedTestKB*1024*8)/a)/1024;k(b)};n.onerror=function(){k(0)};n.onabort=function(){k(0)};p=(new Date()).getTime();if(g.location.protocol==='https:'){speedTestUri=speedTestUri.replace('http:','https:')}n.src=h.speedTestUri+"?r="+Math.random();q=(((h.speedTestKB*8)/h.speedTestTimeout)*1000)+350;var r=setTimeout(function(){k(0)},q)}})(this.rspvly=this.rspvly||{},this.document);